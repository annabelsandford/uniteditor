/*
⠀⠀⠀⠀⢀⣴⣿⡏⠀⠀⠀⠀⠀⠈⠁⠎⠀⣠⠏⠀⢠⠎⠀⠀⢀⣠⠞⠉⢀⣤⠖⠢⢄⠀⠀⠀⠙⢆⢻⡉⠑⠤⡀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⣰⢿⡟⣼⠀⠀⠀⠀⠀⠀⠀⠂⠀⣰⡏⠀⢀⠏⠀⠀⣠⣿⠃⢀⢴⡏⠀⢀⡔⠋⠀⠀⠀⠀⠘⡷⠉⠀⠀⠈⠲⣄⠀⠀⠀⠀⠀
⠀⠀⢰⠋⣼⢀⡏⠀⠀⠀⢀⠀⠀⠀⡁⢠⠇⢧⣀⣸⠀⠀⢰⠣⡇⢠⠋⣾⠀⢀⠎⠀⠀⣠⣖⡛⣗⢦⠇⠶⠶⠶⣖⠀⠈⠳⡤⠤⠦⢄
⠀⣰⠃⢀⡇⢸⡇⠀⠀⠀⣸⡀⠀⠀⢳⡜⠊⠉⠀⠀⠉⠓⢯⡀⢳⣾⠀⢻⡀⠸⡄⠀⢰⠃⠀⠈⠻⣿⣶⣒⣤⠀⠈⠳⡄⠀⠙⣦⠀⠀
⠀⠇⠀⠀⠃⠘⠃⠀⠀⠀⢿⠳⣄⢠⢏⠔⠙⡆⠀⠀⠀⠀⠀⠙⢦⠉⠁⠀⠙⠦⣇⠀⢸⡀⠀⠀⠀⠈⠉⠙⣿⠀⠀⠀⠀⠀⠀⠘⡆⠀
⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢦⡈⡟⣸⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠉⠉⠉⠒⠦⡀⠉⠉⠁⠀⠀⠀⠀⠀⢀⡞⠀⠀⠀⠀⠀⠀⠀⠘⠁
⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣽⡃⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣦⠀⠀⠀⠀⢰⡴⠚⠉⠀⠀⢀⡼⠁⠀⠀⠀⠀⠁
⠁⢠⡴⢚⡛⠺⣟⡖⠒⠚⠋⠁⠘⡇⢣⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠉⠒⠶⠤⢶⡿⢁⡤⠀⠀⠀⠀⠀
⡾⠉⢚⣉⣉⣦⠘⠀⠀⠀⠀⠀⠀⢷⠘⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣠⠤⠤⠤⠤⣀⠠⣤⣖⣯⠴⠋⠀⢠⠄⠀⠀⠀
⠀⣰⠋⠀⠀⣿⠀⠀⠀⠀⠀⠀⠐⠘⣇⠈⢡⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⢏⠆⠠⡀⠀⠀⠈⠳⡘⢦⣀⠀⢀⣠⠏⠀⠀⠀⠀
⠀⡇⠀⢀⡶⠋⠀⠀⠀⠀⠀⠔⠄⢷⣸⣧⠈⠒⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⢃⠇⠀⠀⠇⠀⠀⠀⠀⢳⢀⣈⣩⠽⠃⠀⡰⢻⡄⠀
⡀⢧⡀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⠹⣷⡄⠀⠀⠀⠀⠀⠀⠀⢀⣠⠖⠋⡏⠸⠀⠀⠀⠀⠀⠀⠀⠀⠘⠚⠻⢤⡤⠴⢚⣥⠟⠀⠀
⣧⠀⢉⣳⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⣤⣤⣤⠤⠖⠚⠉⠀⠀⢸⡇⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣺⠋⠀⢀⠀⠀
⠘⠷⣼⣚⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣷⣦⣄⠀⠀⠀⠸⡇⠰⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⣠⠎⠀⢠
⠀⠀⠸⣯⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⣧⠀⢩⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⠛⠛⠁⠀⢀⡏
⠀⠀⠀⠹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⠏⠉⠛⠻⣿⣿⣿⣿⣿⣿⣿⣷⣄⠸⡄⠱⠴⠀⠀⠀⠀⠀⠀⠀⠀⢀⡴⠃⠀⢠⡆⣠⠟⣀
⠀⠀⠀⢸⣟⣀⡀⠀⠀⠀⠀⠀⠀⠀⢠⡏⠀⠠⠀⠀⠈⠻⣿⣿⣿⣿⣿⣿⣿⣷⣷⣀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣿⠇⢀⣤⣿⡾⠛⠛⠉
⠀⠀⢀⣾⣋⣀⠙⢦⠀⠀⠀⠀⠀⠀⣾⠀⠀⠀⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⡟⠈⠹⡗⣖⠒⢚⣿⠛⠛⠛⠓⠛⠉⠀⢸⡇⠀⠀⠀
⠀⣴⠏⠁⠀⠀⠉⣻⣄⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⡿⠋⠀⠀⠣⠌⠘⡇⣾⣿⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀
⣴⠋⠀⠀⠀⣠⠞⠁⠀⠙⣄⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⡿⠋⠀⠀⠀⠀⠈⠀⠰⢡⡏⣿⠀⠀⠀⠀⠀⠀⡼⢸⡃⠀⠀⠀
⡏⠀⠀⢀⠔⠁⠀⠀⠀⣠⠼⠦⡀⠀⢿⠀⠀⠀⠀⠀⠀⠀⢠⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⢁⣾⡁⢸⠀⠀⠀⠀⠀⡼⠁⢸⣷⠀⠀⠀
⠀⠀⠀⠋⠀⠀⣀⡴⠋⢁⠤⠖⠛⠒⢾⡄⠀⠀⠀⠀⣀⡴⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣿⣿⡇⢸⡆⠀⠀⠀⡼⠁⠀⣼⠟⠁⠀⠀
⡄⠀⠀⠀⠀⠚⠁⠀⠀⡏⠀⠀⠀⣰⢸⠻⣤⣤⠶⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣴⣾⣿⣿⣿⣇⢸⡇⠀⠀⡼⠁⠀⠀⣿⠀⠀⠀⠀
⠻⣄⠀⠀⠀⠀⠀⠀⠀⠧⠀⠀⠀⠻⣏⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡴⠒⠚⣿⡻⣿⡛⠛⣿⠿⣛⢾⡇⠀⠜⠀⠀⠀⠀⡏⠀⠀⠀⠀
Sabrina Annabel Sandford (@annabellica) 2023
*/
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Text;
using System.Xml;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Diagnostics;

namespace UnitEditor
{
    public partial class Form1 : Form
    {
        public string ue_ver = "Dev-Build";
        public string ue_sel = "Police"; // pol, ems, fire, tech, misc, all
        public string ue_cleansel = null;
        public string ue_unittype = "Vehicle"; // vehicle, personnel
        public string ue_moddirectory = null;

        public string[] fpb = new string[100];
        public string[] count_fpb = new string[100];
        public string[] fpb_d = new string[100];
        public string[] count_fpb_d = new string[100];

        public Form1(string projectConfigContent)
        {
            InitializeComponent();

            // shorten projectConfigContent to just the last directory
            string projectConfigContent_last = projectConfigContent.Split('\\').Last();

            this.Text += " " + ue_ver + " - " + projectConfigContent_last;

            ue_moddirectory = projectConfigContent;

            getActiveUnits();
            loadSelection("Police");
        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }

        private void getActiveUnits()
        {
            bool freeplaybase = false;
            bool freeplaybase_d = false;

            try
            {
                // check if freeplaybase.xml exists in ue_moddirectory/Specs
                if (File.Exists(ue_moddirectory + "\\Specs\\freeplaybase.xml"))
                {
                    freeplaybase = true;
                }
                else
                {
                    freeplaybase = false;
                    MessageBox.Show("UnitEditor couldn't find freeplaybase.xml in your mod directory. UnitEditor created that file for you.");
                    File.Create(ue_moddirectory + "\\Specs\\freeplaybase.xml");
                }
                // check if freeplaybase.xml exists in ue_moddirectory/Specs
                if (File.Exists(ue_moddirectory + "\\Specs\\freeplaybase_d.xml"))
                {
                    freeplaybase_d = true;
                }
                else
                {
                    freeplaybase_d = false;
                    MessageBox.Show("UnitEditor couldn't find freeplaybase_d.xml in your mod directory. UnitEditor created that file for you.");
                    File.Create(ue_moddirectory + "\\Specs\\freeplaybase_d.xml");
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show("Error while checking for freeplaybase.xml and freeplaybase_d.xml: " + ex.Message);
            }

            if (freeplaybase == true)
            {
                try
                {
                    // in <freeplaybase>, get all <vehicle prototype="mod:Prototypes/Vehicles/01 LA Ambulance/cv_ems.e4p" count="2" />
                    // prototype in fpb and count in count_fpb
                    XmlDocument fpb_xml = new XmlDocument();
                    fpb_xml.Load(ue_moddirectory + "\\Specs\\freeplaybase.xml");
                    foreach (XmlNode fpb_node in fpb_xml.SelectNodes("/freeplaybase/vehicle"))
                    {
                        Array.Resize(ref fpb, fpb.Length + 1);
                        fpb[fpb.Length - 1] = fpb_node.Attributes["prototype"].Value;
                    }
                    foreach (XmlNode fpb_node in fpb_xml.SelectNodes("/freeplaybase/vehicle"))
                    {
                        Array.Resize(ref count_fpb, count_fpb.Length + 1);
                        count_fpb[count_fpb.Length - 1] = fpb_node.Attributes["count"].Value;
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show("Error while reading freeplaybase.xml: " + ex.Message);
                }
            }

            if (freeplaybase_d == true)
            {
                try
                {
                    XmlDocument fpb_xml = new XmlDocument();
                    fpb_xml.Load(ue_moddirectory + "\\Specs\\freeplaybase_d.xml");
                    foreach (XmlNode fpb_node in fpb_xml.SelectNodes("/freeplaybase/vehicle"))
                    {
                        Array.Resize(ref fpb_d, fpb_d.Length + 1);
                        fpb_d[fpb_d.Length - 1] = fpb_node.Attributes["prototype"].Value;
                    }
                    foreach (XmlNode fpb_node in fpb_xml.SelectNodes("/freeplaybase/vehicle"))
                    {
                        Array.Resize(ref count_fpb_d, count_fpb_d.Length + 1);
                        count_fpb_d[count_fpb_d.Length - 1] = fpb_node.Attributes["count"].Value;
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show("Error while reading freeplaybase_d.xml: " + ex.Message);
                }
            }

            // console output all fpb and count_fpb
            for (int i = 0; i < fpb.Length; i++)
            {
                // if fpb is empty, skip
                if (fpb[i] == null)
                {
                    continue;
                }
                // console out
                Console.WriteLine("fpb: " + fpb[i] + " count_fpb: " + count_fpb[i]);
            }
        }

        private void selectUnit(string selected_item, string selected_path)
        {
            GC.Collect();
            string[] complete_selection_path_split = selected_path.Split('\\');
            string display_selection_path = complete_selection_path_split[complete_selection_path_split.Length - 4] + "\\" + complete_selection_path_split[complete_selection_path_split.Length - 3] + "\\" + complete_selection_path_split[complete_selection_path_split.Length - 2] + "\\" + complete_selection_path_split[complete_selection_path_split.Length - 1];
            label_currentUnit.Text = selected_item;
            toolStripStatusLabel1.Text = display_selection_path;

            // change groupBox3 Title to "Quick Edit: " + ue_unittype
            groupBox3.Text = "Quick Edit - Type: " + ue_unittype;

            // XML Stuff comes here ----------------------------------------
            string xml_unit_id = null;
            string xml_missions_value = null;
            string xml_prot_name = null;
            string xml_price_value = null;
            string xml_speed_value = null;
            string xml_space_value = null;
            string xml_loadspace_value = null;
            string xml_personnel = null;
            string xml_equipment = null;

            // check if file unit.xml exists
            if (File.Exists(selected_path + "\\unit.xml"))
            {
                if (ue_unittype == "Vehicle")
                {
                    try
                    {
                        qe_personnel_multiple.Hide();
                        qe_textbox5.Show();
                        qe_textbox6.Show();
                        qe_textbox7.Show();
                        qe_veh_personnel.Show();
                        qe_veh_equipment.Show();
                        qe_label8.Show();
                        qe_label9.Show();
                        qe_textbox5.Enabled = true;
                        qe_textbox6.Enabled = true;
                        qe_textbox7.Enabled = true;
                        qe_textbox2.Enabled = true;

                        // load unit.xml
                        XmlDocument unit_xml = new XmlDocument();
                        unit_xml.Load(selected_path + "\\unit.xml");

                        // get <unit id="AMBULANCE01">
                        XmlNodeList unit = unit_xml.SelectNodes("/unit");
                        foreach (XmlNode unit_node in unit)
                        {
                            xml_unit_id = unit_node.Attributes["id"].Value;
                        }

                        XmlNodeList missions = unit_xml.SelectNodes("/unit/freeplay/missions");
                        foreach (XmlNode mission in missions)
                        {
                            xml_missions_value = mission.Attributes["value"].Value;
                        }

                        XmlNodeList prot_name = unit_xml.SelectNodes("/unit/freeplay/missions/prototype");
                        foreach (XmlNode prot in prot_name)
                        {
                            xml_prot_name = prot.Attributes["name"].Value;
                        }

                        XmlNodeList price = unit_xml.SelectNodes("/unit/freeplay/missions/price");
                        foreach (XmlNode pr in price)
                        {
                            xml_price_value = pr.Attributes["value"].Value;
                        }

                        XmlNodeList speed = unit_xml.SelectNodes("/unit/freeplay/missions/speed");
                        foreach (XmlNode sp in speed)
                        {
                            xml_speed_value = sp.Attributes["value"].Value;
                        }

                        XmlNodeList space = unit_xml.SelectNodes("/unit/freeplay/missions/space");
                        foreach (XmlNode sp in space)
                        {
                            xml_space_value = sp.Attributes["value"].Value;
                        }

                        XmlNodeList loadspace = unit_xml.SelectNodes("/unit/freeplay/missions/loadspace");
                        foreach (XmlNode ls in loadspace)
                        {
                            xml_loadspace_value = ls.Attributes["value"].Value;
                        }

                        XmlNode freeplayNode = unit_xml.SelectSingleNode("/unit/freeplay");
                        XmlNode personnelNode = freeplayNode.SelectSingleNode("missions/personnel");
                        string rawXml = personnelNode.InnerXml;
                        xml_personnel = rawXml;

                        XmlNode equipmentNode = freeplayNode.SelectSingleNode("missions/equipment");
                        string rawXml2 = equipmentNode.InnerXml;
                        xml_equipment = rawXml2;

                        // show each of these values in TextBox1 - TextBox7
                        qe_textbox1.Text = xml_unit_id;
                        qe_textbox2.Text = xml_missions_value;
                        qe_textbox3.Text = xml_prot_name;
                        qe_textbox4.Text = xml_price_value;
                        qe_textbox5.Text = xml_speed_value;
                        qe_textbox6.Text = xml_space_value;
                        qe_textbox7.Text = xml_loadspace_value;
                        qe_veh_personnel.Text = xml_personnel;
                        qe_veh_equipment.Text = xml_equipment;

                        // if missions_value is empty, disable qe_textbox2
                        if (qe_textbox2.Text == "")
                        {
                            qe_textbox2.Enabled = false;
                        }
                        else
                        {
                            qe_textbox2.Enabled = true;
                        }

                        qe_label1.Text = "Unit ID:";
                        qe_label2.Text = "Missions Value:";
                        qe_label3.Text = "Prototype:";
                        qe_label4.Text = "Price:";
                        qe_label5.Text = "Speed:";
                        qe_label6.Text = "Space:";
                        qe_label7.Text = "Loadspace:";
                        qe_label8.Text = "Personnel:";
                        qe_label9.Text = "Equipment:";

                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }
                else if (ue_unittype == "Person")
                {
                    try
                    {
                        qe_textbox5.Show();
                        qe_textbox6.Show();
                        qe_textbox7.Show();
                        qe_veh_personnel.Hide();
                        qe_veh_equipment.Hide();
                        qe_label8.Hide();
                        qe_label9.Hide();
                        qe_textbox5.Enabled = true;
                        qe_textbox6.Enabled = true;
                        qe_textbox7.Enabled = true;
                        qe_textbox2.Enabled = true;

                        // load unit.xml
                        XmlDocument unit_xml = new XmlDocument();
                        unit_xml.Load(selected_path + "\\unit.xml");

                        // get <unit id="AMBULANCE01">
                        XmlNodeList unit = unit_xml.SelectNodes("/unit");
                        foreach (XmlNode unit_node in unit)
                        {
                            xml_unit_id = unit_node.Attributes["id"].Value;
                        }

                        XmlNodeList missions = unit_xml.SelectNodes("/unit/freeplay/missions");
                        foreach (XmlNode mission in missions)
                        {
                            xml_missions_value = mission.Attributes["value"].Value;
                        }

                        XmlNodeList prot_name = unit_xml.SelectNodes("/unit/freeplay/missions/prototype");
                        foreach (XmlNode prot in prot_name)
                        {
                            xml_prot_name = prot.Attributes["name"].Value;
                        }

                        XmlNodeList price = unit_xml.SelectNodes("/unit/freeplay/missions/price");
                        foreach (XmlNode pr in price)
                        {
                            xml_price_value = pr.Attributes["value"].Value;
                        }

                        XmlNodeList speed = unit_xml.SelectNodes("/unit/freeplay/missions/speed");
                        foreach (XmlNode sp in speed)
                        {
                            xml_speed_value = sp.Attributes["value"].Value;
                        }

                        XmlNodeList space = unit_xml.SelectNodes("/unit/freeplay/missions/space");
                        foreach (XmlNode sp in space)
                        {
                            xml_space_value = sp.Attributes["value"].Value;
                        }

                        XmlNodeList loadspace = unit_xml.SelectNodes("/unit/freeplay/missions/loadspace");
                        foreach (XmlNode ls in loadspace)
                        {
                            xml_loadspace_value = ls.Attributes["value"].Value;
                        }

                        // show each of these values in TextBox1 - TextBox7
                        qe_textbox1.Text = xml_unit_id;
                        qe_textbox2.Text = xml_missions_value;
                        qe_textbox3.Text = xml_prot_name;
                        qe_textbox4.Text = xml_price_value;
                        qe_textbox5.Text = xml_speed_value;
                        qe_textbox6.Text = xml_space_value;
                        qe_textbox7.Text = xml_loadspace_value;

                        // if missions_value is empty, disable qe_textbox2
                        if (qe_textbox2.Text == "")
                        {
                            qe_textbox2.Enabled = false;
                        }
                        else
                        {
                            qe_textbox2.Enabled = true;
                        }

                        qe_label1.Text = "Unit ID:";
                        qe_label2.Text = "Missions Value:";
                        qe_label3.Text = "Prototype:";
                        qe_label4.Text = "Price:";
                        qe_label5.Text = "Speed:";
                        qe_label6.Text = "Space:";
                        qe_label7.Text = "Loadspace:";

                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }
            }
            else
            {
                // if file unit.xml does not exist, show MessageBox and disable all TextBoxes
                MessageBox.Show("unit.xml does not exist in the selected path.", "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                qe_textbox1.Enabled = false;
                qe_textbox2.Enabled = false;
                qe_textbox3.Enabled = false;
                qe_textbox4.Enabled = false;
                qe_textbox5.Enabled = false;
                qe_textbox6.Enabled = false;
                qe_textbox7.Enabled = false;
            }
        }

        private void button_pol_Click(object sender, EventArgs e)
        {
            loadSelection("Police");
        }

        private void button_med_Click(object sender, EventArgs e)
        {
            loadSelection("Medical");
        }

        private void button_fire_Click(object sender, EventArgs e)
        {
            loadSelection("Fire");
        }

        private void button_tech_Click(object sender, EventArgs e)
        {
            loadSelection("Technical");
        }

        private void button_fpb_Click(object sender, EventArgs e)
        {
            loadSelection("FreeplayBase");
        }

        private void button_fpb_d_Click(object sender, EventArgs e)
        {
            loadSelection("FreeplayBase_D");
        }

        private void button_save_Click(object sender, EventArgs e)
        {
            saveUnit();
        }

        private void button_refresh_Click(object sender, EventArgs e)
        {
            refreshTreeView();
        }

        private void treeView_units_AfterSelect(object sender, TreeViewEventArgs e)
        {
            string selected_item = treeView_units.SelectedNode.Text;
            string selected_path = treeView_units.SelectedNode.FullPath;

            if (selected_item.Contains(" - "))
            {
                string[] selected_item_split = selected_item.Split('-');
                selected_item = selected_item_split[0].Trim();
            }
            else if (selected_item.Contains(".xml"))
            {
                string[] selected_item_split = selected_item.Split('.');
                selected_item = selected_item_split[0].Trim();
            }

            selectUnit(selected_item, selected_path);
        }

        private void qe_textbox1_TextChanged(object sender, EventArgs e)
        {
            ue_unit_id = qe_textbox1.Text;
        }

        private void qe_textbox2_TextChanged(object sender, EventArgs e)
        {
            ue_missions_value = qe_textbox2.Text;
        }

        private void qe_textbox3_TextChanged(object sender, EventArgs e)
        {
            ue_prototype = qe_textbox3.Text;
        }

        private void qe_textbox4_TextChanged(object sender, EventArgs e)
        {
            ue_price_value = qe_textbox4.Text;
        }

        private void qe_textbox5_TextChanged(object sender, EventArgs e)
        {
            ue_speed_value = qe_textbox5.Text;
        }

        private void qe_textbox6_TextChanged(object sender, EventArgs e)
        {
            ue_space_value = qe_textbox6.Text;
        }

        private void qe_textbox7_TextChanged(object sender, EventArgs e)
        {
            ue_loadspace_value = qe_textbox7.Text;
        }

        private void qe_veh_personnel_TextChanged(object sender, EventArgs e)
        {
            ue_personnel = qe_veh_personnel.Text;
        }

        private void qe_veh_equipment_TextChanged(object sender, EventArgs e)
        {
            ue_equipment = qe_veh_equipment.Text;
        }

        private void qe_personnel_multiple_CheckedChanged(object sender, EventArgs e)
        {
            if (qe_personnel_multiple.Checked == true)
            {
                qe_textbox5.Enabled = false;
                qe_textbox6.Enabled = false;
                qe_textbox7.Enabled = false;
                qe_veh_personnel.Enabled = false;
                qe_veh_equipment.Enabled = false;
            }
            else
            {
                qe_textbox5.Enabled = true;
                qe_textbox6.Enabled = true;
                qe_textbox7.Enabled = true;
                qe_veh_personnel.Enabled = true;
                qe_veh_equipment.Enabled = true;
            }
        }

        private void refreshTreeView()
        {
            treeView_units.Nodes.Clear();
            loadTreeView("Police");
            loadTreeView("Medical");
            loadTreeView("Fire");
            loadTreeView("Technical");
            loadTreeView("FreeplayBase");
            loadTreeView("FreeplayBase_D");
        }

        private void saveUnit()
        {
            if (selected_unit == "")
            {
                MessageBox.Show("No unit selected.", "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            string selected_path = treeView_units.SelectedNode.FullPath;
            string unit_xml_file = selected_path + "\\unit.xml";
            string equipment_xml_file = selected_path + "\\equipment.xml";

            try
            {
                // check if unit.xml exists
                if (!File.Exists(unit_xml_file))
                {
                    MessageBox.Show("unit.xml does not exist in the selected path.", "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                // load unit.xml
                XmlDocument unit_xml = new XmlDocument();
                unit_xml.Load(unit_xml_file);

                // update values in unit.xml
                XmlNodeList unit_id = unit_xml.GetElementsByTagName("unit");
                foreach (XmlNode node in unit_id)
                {
                    node.Attributes["id"].Value = ue_unit_id;
                }

                XmlNodeList missions_value = unit_xml.GetElementsByTagName("missions");
                foreach (XmlNode node in missions_value)
                {
                    node.Attributes["value"].Value = ue_missions_value;
                }

                XmlNodeList prototype = unit_xml.GetElementsByTagName("prototype");
                foreach (XmlNode node in prototype)
                {
                    node.Attributes["name"].Value = ue_prototype;
                }

                XmlNodeList price_value = unit_xml.GetElementsByTagName("price");
                foreach (XmlNode node in price_value)
                {
                    node.Attributes["value"].Value = ue_price_value;
                }

                XmlNodeList speed_value = unit_xml.GetElementsByTagName("speed");
                foreach (XmlNode node in speed_value)
                {
                    node.Attributes["value"].Value = ue_speed_value;
                }

                XmlNodeList space_value = unit_xml.GetElementsByTagName("space");
                foreach (XmlNode node in space_value)
                {
                    node.Attributes["value"].Value = ue_space_value;
                }

                XmlNodeList loadspace_value = unit_xml.GetElementsByTagName("loadspace");
                foreach (XmlNode node in loadspace_value)
                {
                    node.Attributes["value"].Value = ue_loadspace_value;
                }

                XmlNodeList personnel_value = unit_xml.GetElementsByTagName("personnel");
                foreach (XmlNode node in personnel_value)
                {
                    node.InnerXml = ue_personnel;
                }

                XmlNodeList equipment_value = unit_xml.GetElementsByTagName("equipment");
                foreach (XmlNode node in equipment_value)
                {
                    node.InnerXml = ue_equipment;
                }

                // save changes to unit.xml
                unit_xml.Save(unit_xml_file);

                // check if equipment.xml exists
                if (!File.Exists(equipment_xml_file))
                {
                    MessageBox.Show("equipment.xml does not exist in the selected path.", "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                // load equipment.xml
                XmlDocument equipment_xml = new XmlDocument();
                equipment_xml.Load(equipment_xml_file);

                // update values in equipment.xml
                XmlNodeList equipment_id = equipment_xml.GetElementsByTagName("equipment");
                foreach (XmlNode node in equipment_id)
                {
                    node.Attributes["id"].Value = ue_unit_id;
                }

                // save changes to equipment.xml
                equipment_xml.Save(equipment_xml_file);

                MessageBox.Show("Unit saved successfully.", "UE - Success", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "UE - Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
    }
}
